---
alwaysApply: true
---

# React Strict DOM (RSD)

**Goal:** Ultra-fast bundle (< 2KB runtime), cross-platform (web + React Native).

---

## Core Rules

### 1. Only `html.*` Elements
```tsx
// ❌ FORBIDDEN
<div><span>Text</span></div>

// ✅ CORRECT
import { html } from 'react-strict-dom';
<html.div><html.span>Text</html.span></html.div>
```

### 2. Only `css.create()` for Styles
```tsx
// ❌ FORBIDDEN
<html.div className="container" />
<html.div style={{ padding: 16 }} />

// ✅ CORRECT
import { css, html } from 'react-strict-dom';

const styles = css.create({
  container: { padding: 16, backgroundColor: 'white' }
});

<html.div style={styles.container} />
```

### 3. Pseudo-states with `default`
```tsx
const styles = css.create({
  button: {
    backgroundColor: {
      default: 'lightblue',
      ':hover': 'blue',
      ':active': 'navy'
    }
  }
});
```
**Supported:** `:hover`, `:focus`, `:active`, `::placeholder` (color only)

### 4. Media Queries in Styles
```tsx
const styles = css.create({
  container: {
    width: {
      default: 320,
      '@media (min-width: 768px)': 600,
      '@media (min-width: 1024px)': 800
    }
  }
});
```

### 5. Style Composition with Arrays
```tsx
<html.div style={[styles.base, isActive && styles.active, props.style]} />
```

---

## Theming

### Define Tokens (*.css.ts)
```tsx
import { css } from 'react-strict-dom';

export const colors = css.defineVars({
  primary: { default: 'blue', '@media (prefers-color-scheme: dark)': 'lightblue' },
  background: { default: 'white', '@media (prefers-color-scheme: dark)': '#222' }
});
```

### Use Tokens
```tsx
import { colors } from './tokens.css';

const styles = css.create({
  container: {
    color: colors.primary,
    backgroundColor: colors.background
  }
});
```

### Theme Override
```tsx
const darkTheme = css.createTheme(colors, {
  primary: 'purple',
  background: '#111'
});

<html.div style={darkTheme}>{children}</html.div>
```

---

## Cross-Platform Constraints

| Feature | Web | Native |
|---------|-----|--------|
| `display: flex` | ✅ | ✅ |
| `display: grid` | ✅ | ❌ |
| `display: inline-flex` | ✅ | ❌ |
| `position: fixed/sticky` | ✅ | ❌ |
| `calc()`, `min()`, `max()` | ✅ | ❌ |
| CSS animations | ✅ | ❌ |
| 3D transforms | ✅ | ❌ |

**Safe cross-platform:** `flex`, `none`, `relative`, `absolute`, `static`

---

## Props Differences

```tsx
// ❌ React DOM
<label htmlFor="id">
<div role="presentation">

// ✅ RSD
<html.label for="id">
<html.div role="none">
```

---

## Refs (callback only)
```tsx
<html.div ref={(node) => {
  if (node) {
    node.getBoundingClientRect();
    node.focus();
  }
}} />
```

---

## Available Elements

**Layout:** `div`, `section`, `article`, `header`, `footer`, `nav`, `main`, `aside`
**Text:** `span`, `p`, `h1`-`h6`, `strong`, `em`
**Interactive:** `button`, `a`, `input`, `textarea`, `select`
**Media:** `img`
**Lists:** `ul`, `ol`, `li`

---

## Common Mistakes

| ❌ Wrong | ✅ Correct |
|----------|-----------|
| `className="..."` | `style={styles.x}` |
| `htmlFor="id"` | `for="id"` |
| `role="presentation"` | `role="none"` |
| `style={{ padding: 16 }}` | `css.create({ x: { padding: 16 } })` |
| `margin: "16px 8px"` | `margin: 16` (single value) |
| Missing `default` | Always include with pseudo/media |

---

## Setup Checklist

- [ ] `npm install react-strict-dom`
- [ ] Babel: `react-strict-dom/babel-preset`
- [ ] PostCSS: `react-strict-dom/postcss-plugin`
- [ ] Root: `data-layoutconformance="strict"`
- [ ] Import CSS with `@react-strict-dom` directive

---

## Performance Targets

- Bundle runtime: < 2KB gzipped
- Atomic CSS output
- Zero runtime style calculations
- Cross-platform: web + React Native
